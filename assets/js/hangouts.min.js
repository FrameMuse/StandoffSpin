var features_toLoad;String.prototype.intConvert=function(){return parseInt(this,10)},String.prototype.num_split=function(){for(var a=[],b=this.toString(),c=b.length,d=0;d<c;d++)a.push(+b.charAt(d));return a},window.getLanguage=a=>{var b=a.split("."),c=window._language;for(var d of b){if(!c[d]){c="not found "+a;break}c=c[d]}return c},$.fn.extend({toggleText:function(c,a=null){return this.html(this.html()==a?c:a)},num_split:function(){for(var a=[],b=this.text().toString(),c=b.length,d=0;d<c;d++)a.push(+b.charAt(d));return a}}),$(document).on("click",".faq__summary",function(){$(this).parent().toggleClass("faq__clause--deployed")}),$(document).on("click",".tab-swithcer__button",function(){$(".tab-swithcer__button").removeClass("tab-swithcer__button--active");var a=$(this).addClass("tab-swithcer__button--active").attr("tab");$("[class *= 'js-tab-']").addClass("hidden"),$("[class *= 'js-tab-"+a+"']").removeClass("hidden")}),$(document).on("click",".sorted-skins .sorted-skins__unit[pickable]",function(){features.contract.spot.takePlace($(this)),features.contract.update_DOM()}),$(document).on("click",".contract__spot .sorted-skins__unit[pickable]",function(){features.contract.spot.freeUpPlace($(this)),features.contract.update_DOM()});class features_lang{constructor(){this.tap="ru",this.onclick=function(){},this.path="/assets/img/icons/";this;$(".js-option-lang").click(()=>{var a=this.toggleTap("ru","en");$(".topbar-language__icon").css({"background-image":`url(${this.path+a+".png"})`}),$(".topbar-language__text").html(a),this.onclick(a)})}toggleTap(c,a=null){return this.tap=this.tap==a?c:a}}class features_sound{constructor(){this.tap="on",this.onclick=function(){};const a=this;$(".js-option-volume").click(function(){$(this).find(".stndfspin-features__icon").toggleClass("stndfspin-button--unfilled").toggleClass("stndfspin-features__icon--green").parent().find(".stndfspin-features__column > span").toggleText("\u0412\u043A\u043B.","\u0412\u044B\u043A\u043B."),a.onclick(a.toggleTap("on","off"))})}toggleTap(c,a=null){return this.tap=this.tap==a?c:a}}class features_timer{constructor(){this.data={numbers:{seconds:0,minutes:0,hours:0}}}counts(a=""){return $(".timer-v2__count[data-count='"+a+"']").find("span")}async initiate(a={},b=1){return this.data.numbers=a,this.promise=new Promise(c=>{var d=setInterval(()=>{if(this.single_discount("seconds",59)&&this.single_discount("minutes",59)&&this.single_discount("hours",24))return clearInterval(d),void c();for(const b in a)this.counts(b).each(function(c){$(this).html(num_split(a[b],2)[c])})},1e3/b)}),await this.promise}single_discount(a="",b=0){return!(null!=this.data.numbers[a])||(0>=this.data.numbers[a]?(this.data.numbers[a]=b,!0):void this.data.numbers[a]--)}}class features_wheel{constructor(){this.reopen={onclick:function(){}},this.data={spins:4,animation:"16s cubic-bezier(.1, 0, 0, 1) transform",duration:16000},$(document).on("click",".js-wheel-reopen",()=>{this.reopen.onclick()}),$(document).on("click",".box__input",function(){$(".box__input").removeClass("box__input--active"),$(this).addClass("box__input--active")})}init(){features.paging.progress=75,this.data.multiplier={0:1,1:2,2:3,3:4,4:5,5:10}[$(".box__input--active").attr("data-id")],this.multiple(this.data.multiplier),this.count(12),this.switch()}getRotationDegrees(c){var d=c.css("-webkit-transform")||c.css("-moz-transform")||c.css("-ms-transform")||c.css("-o-transform")||c.css("transform");if("none"!==d)var e=d.split("(")[1].split(")")[0].split(","),f=e[0],a=e[1],b=Math.round(Math.atan2(a,f)*(180/Math.PI));else var b=0;return 0>b?b+360:b}spinTo(a,b=0){var c=this.find_item(b,a),d=360*this.data.spins-this.getRotationDegrees(c),e=c.parent();e.css({animation:"unset"});const f=new Promise(a=>{var b=setInterval(()=>{"spinning"!=e.css("animation")&&(a(),clearInterval(b))},75)});return f.then(()=>{e.css({transform:"rotate("+d+"deg)"})}),features.paging.progress=100,c}checkUp(a,b){return console.log(b),new Promise(c=>{setTimeout(()=>{var d=setInterval(()=>{if(360==this.getRotationDegrees(a)+this.getRotationDegrees($(".fortune-wheel[data-id='"+b+"'] .fortune__circle")))return clearInterval(d),void c()},500)},1e3*this.data.duration)})}win(a={},b=0,c=!1){var d=this.spinTo(a.id,b),e=d.parent().parent(),f=c?0:3e3;setTimeout(()=>{d.find(".weapon-skins__image").attr({src:a.item.image}),d.find(".sorted-skins__skin-title--0").html(a.item.name),d.find(".sorted-skins__skin-title--0").html(a.item.subname),d.find(".sorted-skins__skin-title--0").html(a.item.subname),d.find(".sorted-skins__cost").html(a.item.price),d.find(".sorted-skins__unit").attr({class:"sorted-skins__unit sorted-skins__unit--"+a.item.class_name}),e.find(".fortune-wheel__inner .sorted-skins__unit").html(d.html())},f),setTimeout(()=>{features.paging.progress=null},250)}multiple_win(a={},b=!1){for(const c in a)this.win(a[c],c,b);var c=new Promise(a=>b?(features.paging.progress=null,void a()):void setTimeout(()=>{a()},this.data.duration));return c.then(()=>{$(".fortune__circle, .fortune-wheel__inner, .fortune-wheel__curve-1, .fortune-wheel__curve-2").toggleClass("hidden"),$(".fortune-wheel").addClass("fortune-wheel--without-after")}),this.promise=c}count(a){this.number=a;var b=+$(".fortune__item").css("height").replace("px","");$(".fortune__item").each(function(b){$(this).css({transform:"rotate("+360/a*b+"deg) translateY(var(--wheel-indent))"})}),$(".fortune-wheel").css({"--wheel-item-skew":b/(114/(360/a))+"px","--wheel-underline-width":"calc(0.625em / "+114/(360/a)+")"})}find_item(a,b){var c=$(".fortune-wheel[data-id='"+a+"'] .fortune__item:nth-child("+b+")");if(0<c.length)return c;throw"There is no such an item"}multiple(a){this.tideUp();for(var b=$(".fortune-wheel"),c=b.parent(),d=0;d<a;d++)c.append(b.clone().attr("data-id",d));$(".fortune-wheel:not([data-id])").remove(),$(".fortune-wheel__inner").removeClass("fortune-wheel__inner--0 fortune-wheel__inner--1"),1<a?($(".fortune-wheel__buttons").addClass("hidden"),$(".fortune-wheel__inner").addClass("fortune-wheel__inner--1")):($(".fortune-wheel__buttons").removeClass("hidden"),$(".fortune-wheel__inner").addClass("fortune-wheel__inner--0")),2==a&&$(".box").css("--wheel-font-size","5.25px"),3<=a&&$(".box").css("--wheel-font-size","3.5px")}tideUp(){$(".box").css("--wheel-font-size",""),$(".fortune-wheel").each(function(a){0!=a&&$(this).remove()})}switch(){$(".box__view, .fortune-wheel").toggleClass("hidden")}}class features_popup{constructor(){this.html=`<div class="popup" hidden="hidden"><div class="popup__cover"></div><div class="popup-window scale-out"><div class="popup-window__close">✖</div><div class="popup-window__article"><span class="popup-window__title"></span><span class="popup-window__summary"></span></div><div class="popup-window__content"></div><div class="popup-window__help">Есть вопросы? Пишите в <a href="https://vk.com/standoffroll" classname="popup-window__marked">группу поддержки VK</a></div></div></div>`,this.on=function(){},this.getLanguage=function(){},this.default()}default(){0==$(".popup").length&&$("body").append(this.html),$(".popup-window__close, .popup__cover").click(()=>{features.popup.fadeOut()})}tend(a){return $(".popup-window__"+a)}wEdit(a={}){for(var b in a)this.tend(b).html(a[b])}fadeIn(a){$(".popup").removeAttr("hidden"),setTimeout(()=>{a.removeClass("scale-out scale-in").addClass("scale-in")},50)}fadeOut(){var a=$(".popup");a.find("> *:not(.popup__cover)").removeClass("scale-out scale-in").addClass("scale-out"),setTimeout(()=>a.attr("hidden",""),200)}open(a,b={}){this.wText=function(b){return this.getLanguage("popup."+a+"."+b)},this.title=this.wText("title"),this.summary=this.wText("summary"),this.wEdit({title:null,summary:null,content:null,help:this.getLanguage("popup.help.html")}),this.on(a,b),this.fadeIn($(".popup-window"))}close(){$(".popup-window__close, .popup__cover").click()}}class features_referal{init(){this.name=name,this.default(),this.progress_block="<div class=\"goal__line\"><div class=\"goal__line--line-progress\"></div><div class=\"goal__counter\"><span class=\"goal__counter--icon\"></span><span class=\"goal__counter--amount\"></span></div></div>",this.commit_progress(2,89)}default(){this.goals_number=$(".goal").length,this.width=$(this.name).outerWidth(),this.goal_width=$(".goal").outerWidth(),this.goal_height=$(".goal__image").outerHeight(),this.goal_indent=$(".goal[data-goal-id='2']").css("margin-left").replace("px","").intConvert(),this.goal_image=$(".goal__image").outerWidth(),this.goal_goal_height=$(".goal__goal").outerHeight()}create_progress_block(){return 1>=this.goals_number?void console.error("Too few elements at the page ("+this.goals_number+")"):void $(this.name).append(this.progress_block)}create_goal(a,b,c,d,e=""){if(e)var e="goal__reached";var f="<div class=\"goal "+e+"\" data-goal-id=\""+this.goals_number+"\"><div class=\"goal__goal\">"+a+"</div><div class=\"goal__image\"><img class=\"goal__image--image\" src=\""+c+"\"></div><div class=\"goal__level\">"+b+"</div><div class=\"goal__rewards\">"+d+"</div>";return this.goals_number++,f}add_goal(a){var b=this.create_goal(a.goal,a.level,a.image,a.rewards,a.reached);$(this.name).append(b)}get_progress(a,b){var c=this.goal_width+this.goal_indent,b=b/100,d=c*a-c+this.goal_width+c*b-c;return d}commit_progress(a,b,c){var d=this.get_progress(a,b);return d>this.width?(console.log(d),console.error("Commited line is too big for '"+this.name+"'"),d+"px"):(0>d&&(d=0),1>=this.goals_number?void console.error("Too few elements at the page ("+this.goals_number+")"):void(90<=b&&100>=b||10<=b&&2>=b?$(".goal__counter").addClass("hidden"):$(".goal__counter").removeClass("hidden"),c&&$(".goal__counter--amount").html(c),$(".goal__line--line-progress").css("width",d+"px"),$(".goal__counter").css("left",d-$(".goal__counter").outerWidth()/2+"px"),$(".goal__line").css("top",this.goal_image_indent+this.goal_goal_height+this.goal_height/2+"px")))}}class features_contract{constructor(){this.onpop=function(){},this.spot=new class{constructor(){this.error=function(){},this.saf=!0,this.spots=[]}init(){$(".contract__spot").each((a,b)=>{this.spots.push({status:"unoccupied",object:b,data:{title:null,amount:null}}),$(b).attr("data-id",a)})}takePlace(a){var b=this.whichAvail().shift(),c=this.setOcp(b);c&&(a.clone().appendTo(c),this.data("get",b),a.remove(),this.caution())}freeUpPlace(a){var b=a.parent().attr("data-id");this.setUnocp(b)&&(a.clone().appendTo($(".sorted-skins")),this.data(null,b),a.remove(),this.caution())}whichAvail(a="unoccupied"){for(var b=[],c=0;c<this.spots.length;c++)this.spots[c].status==a&&b.push(c);return b}setOcp(a){try{return this.spots[a].status="occupied",this.spots[a].object}catch(a){return this.error("Exceeded_index_range"),!1}}setUnocp(a){try{return this.spots[a].status="unoccupied",this.spots[a].object}catch(a){return this.error("Exceeded_index_range"),!1}}data(a,b){switch(a){case"get":try{const a=this.spots[b].object;this.spots[b].data={title:$(a).find(".sorted-skins__skin-title").html(),amount:$(a).find(".sorted-skins__cost").html().replace(" P","")}}catch(a){this.error("lack_title_or_cost")}break;case null:this.spots[b].data={title:null,amount:null};}}caution(){var a=this.whichAvail("occupied");3<=a.length?($(".contract__caution").hide(),this.saf=!1):($(".contract__caution").show(),this.saf=!0)}}}init(){$(".contract-result__input").attr("disabled"),$(".contract-window").appendTo(".popup").removeClass("hidden"),$(".contract__button").click(()=>!0==this.spot.saf?void this.onpop():void(features.popup.fadeIn($(".contract-window")),this.fill()))}fill(){for(var a=0,b=0;a<this.spot.spots.length;a++)$(".contract-window__table--row:nth-child("+(a+1)+") .js-contract-row").html(this.spot.spots[a].data.title),"occupied"==this.spot.spots[a].status&&(b+=+this.spot.spots[a].data.amount)}count_sum(){for(var a=0,b=0;a<this.spot.spots.length;a++)"occupied"==this.spot.spots[a].status&&(b+=+this.spot.spots[a].data.amount);return b}update_DOM(){$(".js-contract-items").html(this.spot.whichAvail("occupied").length),$(".js-contract-sum").html(this.count_sum())}}class features_canvas{init(){this.isMouseDown=!1,this.canvas_out=$(".contract-window__canvas"),this.canvas=this.canvas_out[0],this.canvas.width=this.canvas_out.outerWidth(),this.canvas.height=this.canvas_out.outerHeight(),this.body=$("body"),this.canvas,this.ctx=this.canvas.getContext("2d"),this.linesArray=[],this.currentSize=1,this.currentColor="rgb(225,225,225)",this.currentBg="white",this.canvas.addEventListener("mousedown",()=>{this.mousedown(this.canvas,event)}),this.canvas.addEventListener("mousemove",()=>{this.mousemove(this.canvas,event)}),this.canvas.addEventListener("mouseup",()=>{this.mouseup()})}save(){localStorage.removeItem("savedCanvas"),localStorage.setItem("savedCanvas",JSON.stringify(this.linesArray)),console.log("Saved canvas!")}redraw(){for(var a=1;a<this.linesArray.length;a++)this.ctx.beginPath(),this.ctx.moveTo(this.linesArray[a-1].x,this.linesArray[a-1].y),this.ctx.lineWidth=this.linesArray[a].size,this.ctx.lineCap="round",this.ctx.strokeStyle=this.linesArray[a].color,this.ctx.lineTo(this.linesArray[a].x,this.linesArray[a].y),this.ctx.stroke()}getMousePos(a,b){var c=this.canvas.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}mousedown(a,b){this.getMousePos(this.canvas,b);this.isMouseDown=!0;var c=this.getMousePos(this.canvas,b);this.ctx.moveTo(c.x,c.y),this.ctx.beginPath(),this.ctx.lineWidth=this.currentSize,this.ctx.lineCap="round",this.ctx.strokeStyle=this.currentColor}mousemove(a,b){if(this.isMouseDown){var c=this.getMousePos(this.canvas,b);this.ctx.lineTo(c.x,c.y),this.ctx.stroke(),this.store(c.x,c.y,this.currentSize,this.currentColor)}}store(a,b,d,e){this.linesArray.push({x:a,y:b,size:d,color:e})}mouseup(){this.isMouseDown=!1,this.store(),this.redraw()}downloadCanvas(a,b,c){a.href=document.getElementById(b).toDataURL(),a.download=c}}class features_paging{constructor(){this.pages={},this.fickle=".ajax-fickle",this.progress=15,postLoader.add(()=>{this.default()}),$("body").append(`<div class="notifier"><div class="notifier__message"></div><span class="notifier__signal"></span></div>`),$(document).on("click","a.ajax-link",a=>{a.preventDefault();var b=$(a.currentTarget).attr("href");null==b?console.error("The link attr is empty"):this.load(b)})}default(){null==history.state?this.load(window.location.pathname):(this.progress=25,this.active_page=history.state.href,this.final(history.state.data)),window.onpopstate=a=>{this.isFirstInHistory()&&this.request(a.state.href),$(this.fickle).html(a.state.data)}}load(a,b=!0){this.progress=25,this.dynamic_request(a,c=>{this.active_page=a,null==history.state?history.replaceState({href:a,first:!0,data:c},"",a):b&&history.pushState({href:a,data:c},"",a),this.final(c)})}dynamic_request(a,b){$.ajax({url:a,headers:{"DYNAMIC-REQUEST":!0},dataType:"html",success:b,error:a=>{this.progress=null,console.warn("Page Loading Error:",a),"undefined"==typeof a.responseJSON&&(a.responseJSON={message:"Undefined error"}),features.paging.notify(a.statusText,`Page Loading Error: "`+a.responseJSON.message+`"`)}})}request(a,b){$.ajax({url:a,dataType:"html",success:b})}final(a){$(this.fickle).html(a),prevent_error_function(features_toLoad),this.progress=100,setTimeout(()=>{this.progress=null},282.5)}addPage(a,b){a=a.replace("/",""),this.pages[a]=b}onPageLoaded(a){console.log(a),a[1]in this.pages&&this.pages[a[1]]()}isFirstInHistory(){return null!=history.state&&history.state.first}set active_page(a){this.pageLoaded=a.split("/"),this.onPageLoaded(this.pageLoaded),$(".topbar-menu, .bottombar-menu").each(function(){var b=$(this).attr("class")+"__link--active";$(this).find("a").removeClass(b),$(this).find("a[href='"+a+"']").addClass(b)})}set progress(a){if(null==a){var b=0;a=""}else{var b="";a+="%"}$(".load-indicator").css({opacity:b}).find(".load-indicator__fill").css({width:a})}notify(a,b){$(".notifier").animate({bottom:"0%"},350).delay(1e4).animate({bottom:"-15%"},350),$(".notifier__message").html(b),$(".notifier__signal").css({background:"hsl("+{error:0,warning:50,success:100}[a]+", 50%, 40%)"})}}const api=new class{constructor(){this.version="v1",this.host="https://standoffspin.ru",this.path=this.host+"/api/"+this.version}request(a,b,c={},d){$.ajax({url:this.url(b),method:a,headers:{"X-CSRF-TOKEN":$("meta[name=\"csrf-token\"]").attr("content")},dataType:"json",data:$.param(c),success:d,error:a=>{console.warn("API Request Error:",a),"undefined"==typeof a.responseJSON.message&&(a.responseJSON={message:"Undefined error"}),features.paging.notify(a.statusText,`API Request Error: "`+a.responseJSON.message+`"`)}})}post(a,b={},c=function(){}){this.request("POST",a,b,c)}get(a,b={},c=function(){}){this.request("GET",a,b,c)}url(a){return this.path+a}},postLoader=new class{constructor(){this.scripts=[],$(window).on("load",()=>this.load())}add(a){this.scripts.push(a)}load(){this.scripts.forEach(a=>a())}},features=new class{constructor(){this.sound=new features_sound,this.lang=new features_lang,this.timer=new features_timer,this.wheel=new features_wheel,this.popup=new features_popup,this.referal=new features_referal,this.contract=new features_contract,this.canvas=new features_canvas,this.paging=new features_paging,this.on=function(){}}set on(a){a()}},DOM=new class{init(){this.targets=[],this.observer=new MutationObserver(a=>this.callback(a))}callback(a){a.forEach(a=>{this.targets.filter(b=>{b.target===a.target&&(b.promise.resolve(),this.observer.disconnect())})})}await(a,b){const c=new $.Deferred;return this.init(),$(a).each((a,d)=>{this.targets.push({target:d,promise:c}),this.observer.observe(d,b)}),c.promise()}update(a,b){for(const c in b)$(".js-"+a+"-"+c).html(b[c])}};function num_split(a=0,b=0){for(var c=a.toString(),d=c.length,b=d>=b?0:b-d,e=Array(b).fill(0),f=0;f<d;f++)e.push(+c.charAt(f));return e}function prevent_error_function(a,...b){try{a(...b)}catch(a){console.warn("Function error prevented: "+a)}}async function __wait(a,b){await b(),await setTimeout(()=>{},a)}